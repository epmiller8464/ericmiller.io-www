{"version":3,"sources":["../../routes/voice-mail.js"],"names":["express","require","router","Router","VoiceMessage","createSignedUrl","get","req","res","next","links","find","isTemp","err","docs","render","title","images","map","vm","toObject","waveForm","key","push","filter","i","v","reverse","surl","meta","Key","_id","image","audio_path","join","delete","fileName","module","exports"],"mappings":"AAAA;;AACA,IAAIA,UAAUC,QAAQ,SAAR,CAAd;AACA,IAAIC,SAASF,QAAQG,MAAR,EAAb;;eACuBF,QAAQ,cAAR,C;IAAhBG,Y,YAAAA,Y;;gBACmBH,QAAQ,sBAAR,C;IAAnBI,e,aAAAA,e;;AACPH,OAAOI,GAAP,CAAW,GAAX,EAAgB,UAAUC,GAAV,EAAeC,GAAf,EAAoBC,IAApB,EAA0B;AACxC,MAAIC,QAAQ,EAAZ;AACAN,eAAaO,IAAb,CAAkB,EAACC,QAAQ,KAAT,EAAlB,EAAmC,UAACC,GAAD,EAAMC,IAAN,EAAe;AAChD;AACA,QAAID,GAAJ,EAASL,IAAIO,MAAJ,CAAW,YAAX,EAAyB,EAACC,OAAO,SAAR,EAAmBC,QAAQ,EAA3B,EAAzB;AACTP,YAAQI,KAAKI,GAAL,CAAS,UAACC,EAAD,EAAQ;AAAC,aAAOA,GAAGC,QAAH,EAAP;AAAqB,KAAvC,EAAyCF,GAAzC,CAA6C,UAACC,EAAD,EAAQ;AAC3D,UAAIE,WAAW,EAAf;AACA,WAAK,IAAIC,GAAT,IAAgBH,GAAGE,QAAnB,EAA6B;AAC3B,YAAIF,GAAGE,QAAH,CAAYC,GAAZ,CAAJ,EACED,SAASE,IAAT,CAAcJ,GAAGE,QAAH,CAAYC,GAAZ,CAAd;AACH;AACDD,iBAAWA,SAASG,MAAT,CAAgB,UAACC,CAAD,EAAIC,CAAJ,EAAU;AAAC,YAAIA,CAAJ,EAAO,OAAOA,CAAP;AAAU,OAA5C,EAA8CC,OAA9C,EAAX;AACA,UAAIC,OAAOvB,gBAAgBc,GAAGU,IAAH,CAAQC,GAAxB,CAAX;AACA,aAAO,EAACR,KAAKH,GAAGY,GAAT,EAAcC,OAAOb,GAAGa,KAAxB,EAA+BC,YAAYL,IAA3C,EAAiDP,UAAUA,SAASa,IAAT,CAAc,GAAd,CAA3D,EAAP;AACD,KATO,CAAR;AAUA1B,QAAIO,MAAJ,CAAW,YAAX,EAAyB,EAACC,OAAO,SAAR,EAAmBC,QAAQP,KAA3B,EAAzB;AACD,GAdD;AAeD,CAjBD;;AAmBAR,OAAOiC,MAAP,CAAc,MAAd,EAAsB,UAAC5B,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACxC,MAAI2B,WAAW,EAAf;AAED,CAHD;;AAKAC,OAAOC,OAAP,GAAiBpC,MAAjB","file":"voice-mail.js","sourcesContent":["'use strict'\nvar express = require('express')\nvar router = express.Router()\nconst {VoiceMessage} = require('../lib/model')\nconst {createSignedUrl} = require('../lib/authorization')\nrouter.get('/', function (req, res, next) {\n  let links = []\n  VoiceMessage.find({isTemp: false}, (err, docs) => {\n    // let value = JSON.parse(data.value)\n    if (err) res.render('voice-mail', {title: 'Express', images: []})\n    links = docs.map((vm) => {return vm.toObject()}).map((vm) => {\n      let waveForm = []\n      for (var key in vm.waveForm) {\n        if (vm.waveForm[key])\n          waveForm.push(vm.waveForm[key])\n      }\n      waveForm = waveForm.filter((i, v) => {if (v) return v }).reverse()\n      let surl = createSignedUrl(vm.meta.Key)\n      return {key: vm._id, image: vm.image, audio_path: surl, waveForm: waveForm.join(',')}\n    })\n    res.render('voice-mail', {title: 'Express', images: links})\n  })\n})\n\nrouter.delete('/:id', (req, res, next) => {\n  let fileName = ''\n\n})\n\nmodule.exports = router\n"]}