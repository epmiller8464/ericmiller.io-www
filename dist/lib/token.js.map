{"version":3,"sources":["../../lib/token.js"],"names":["uuid","require","jwt","createAudioSignature","email","ip","challenge_ts","jwtid","v4","payload","type","id","jwtOpts","expiresIn","subject","token","sign","process","env","JWT_SIGNATURE","e","error","module","exports"],"mappings":"AAAA;;AACA,IAAIA,OAAOC,QAAQ,MAAR,CAAX;AACA,IAAIC,MAAMD,QAAQ,cAAR,CAAV;AACA,IAAME,uBAAuB,SAAvBA,oBAAuB,OAAqC;AAAA,MAA1BC,KAA0B,QAA1BA,KAA0B;AAAA,MAAnBC,EAAmB,QAAnBA,EAAmB;AAAA,MAAfC,YAAe,QAAfA,YAAe;;AAChE,MAAI;AACF,QAAIC,QAAQP,KAAKQ,EAAL,EAAZ;;AAEA,QAAIC,UAAU;AACZL,aAAOA,KADK;AAEZC,UAAIA,EAFQ;AAGZC,oBAAcA,YAHF;AAIZI,YAAM,gBAJM;AAKZC,UAAIJ;AALQ,KAAd;;AAQA,QAAIK,UAAU;AACZC,iBAAW,MADC;AAEZC,eAASV;AAFG,KAAd;AAIA,QAAIW,QAAQb,IAAIc,IAAJ,CAASP,OAAT,EAAkBQ,QAAQC,GAAR,CAAYC,aAA9B,EAA6CP,OAA7C,CAAZ;AACA,WAAO,EAACL,YAAD,EAAQQ,YAAR,EAAP;AACD,GAjBD,CAiBE,OAAOK,CAAP,EAAU;AACV,WAAO,EAACC,OAAOD,CAAR,EAAP;AACD;AACF,CArBD;;AAuBAE,OAAOC,OAAP,GAAiB,EAACpB,0CAAD,EAAjB","file":"token.js","sourcesContent":["'use strict'\nlet uuid = require('uuid')\nlet jwt = require('jsonwebtoken')\nconst createAudioSignature = function ({email, ip, challenge_ts}) {\n  try {\n    let jwtid = uuid.v4()\n\n    let payload = {\n      email: email,\n      ip: ip,\n      challenge_ts: challenge_ts,\n      type: 'no-robot-token',\n      id: jwtid\n    }\n\n    let jwtOpts = {\n      expiresIn: '300s',\n      subject: email\n    }\n    let token = jwt.sign(payload, process.env.JWT_SIGNATURE, jwtOpts)\n    return {jwtid, token}\n  } catch (e) {\n    return {error: e}\n  }\n}\n\nmodule.exports = {createAudioSignature}\n"]}