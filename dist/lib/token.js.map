{"version":3,"sources":["../../lib/token.js"],"names":["uuid","require","jwt","createAudioSignature","cb","email","ip","challenge_ts","jwtid","v4","payload","type","jwtOpts","expiresIn","subject","sign","process","env","JWT_SIGNATURE","err","token","module","exports"],"mappings":"AAAA;;AACA,IAAIA,OAAOC,QAAQ,MAAR,CAAX;AACA,IAAIC,MAAMD,QAAQ,cAAR,CAAV;AACA,IAAME,uBAAuB,SAAvBA,oBAAuB,OAAqCC,EAArC,EAAyC;AAAA,MAA9BC,KAA8B,QAA9BA,KAA8B;AAAA,MAAvBC,EAAuB,QAAvBA,EAAuB;AAAA,MAAnBC,YAAmB,QAAnBA,YAAmB;;;AAEpE,MAAIC,QAAQR,KAAKS,EAAL,EAAZ;;AAEA,MAAIC,UAAU;AACZL,WAAOA,KADK;AAEZC,QAAIA,EAFQ;AAGZC,kBAAcA,YAHF;AAIZI,UAAM;AAJM,GAAd;;AAOA,MAAIC,UAAU;AACZC,eAAY,KAAK,CADL;AAEZC,aAAST,KAFG;AAGZG,WAAOA;AAHK,GAAd;AAKAN,MAAIa,IAAJ,CAASL,OAAT,EAAkBM,QAAQC,GAAR,CAAYC,aAA9B,EAA6CN,OAA7C,EAAsD,UAAUO,GAAV,EAAeC,KAAf,EAAsB;AAC1E,QAAID,GAAJ,EACE,OAAOf,GAAGe,GAAH,EAAQ,IAAR,CAAP;;AAEF,WAAOf,GAAG,IAAH,EAAS,EAACI,YAAD,EAAQY,YAAR,EAAT,CAAP;AACD,GALD;AAMD,CAtBD;;AAwBAC,OAAOC,OAAP,GAAiB,EAACnB,0CAAD,EAAjB","file":"token.js","sourcesContent":["'use strict'\nlet uuid = require('uuid')\nlet jwt = require('jsonwebtoken')\nconst createAudioSignature = function ({email, ip, challenge_ts}, cb) {\n\n  let jwtid = uuid.v4()\n\n  let payload = {\n    email: email,\n    ip: ip,\n    challenge_ts: challenge_ts,\n    type: 'no-robot-token'\n  }\n\n  let jwtOpts = {\n    expiresIn: (60 * 5),\n    subject: email,\n    jwtid: jwtid\n  }\n  jwt.sign(payload, process.env.JWT_SIGNATURE, jwtOpts, function (err, token) {\n    if (err)\n      return cb(err, null)\n\n    return cb(null, {jwtid, token})\n  })\n}\n\nmodule.exports = {createAudioSignature}\n"]}