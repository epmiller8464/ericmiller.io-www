{"version":3,"sources":["../../lib/voice-service.js"],"names":["client","require","process","env","TWILIO_SID","TWILIO_AUTH_TOKEN","fetchCalls","calls","each","call","rt","fetchTranscribedRecordings","sid","push","fetchIncomingCall","cid","cb","from","recordings","api","fetch","then","c","rtcs","transcribe","x","page","r","ts","instances","onboardNewCallData","callLog","notifyMe","to","notifyServer","pushNotify","updateCallLog","module","exports","fetchCall"],"mappings":"AAAA;;AACA,IAAMA,SAASC,QAAQ,QAAR,EAAkBC,QAAQC,GAAR,CAAYC,UAA9B,EAA0CF,QAAQC,GAAR,CAAYE,iBAAtD,CAAf;;AAEA;;AAEA,SAASC,UAAT,GAAuB;AACrB;AACA,MAAIC,QAAQ,EAAZ;AACAP,SAAOO,KAAP,CAAaC,IAAb,CAAkB,UAACC,IAAD,EAAU;AAC1B,QAAIC,KAAKC,2BAA2BF,KAAKG,GAAhC,CAAT;AACAL,UAAMM,IAAN,CAAWH,EAAX;AACD,GAHD;AAIA,SAAOH,KAAP;AACD;;AAED,SAASO,iBAAT,CAA4BC,GAA5B,EAAiCC,EAAjC,EAAqC;AACnC,MAAIP,OAAO;AACTA,UAAM,EADG;AAETQ,UAAM,EAFG;AAGTC,gBAAY;AAHH,GAAX;AAKAlB,SAAOmB,GAAP,CAAWZ,KAAX,CAAiBQ,GAAjB,EAAsBK,KAAtB,GACCC,IADD,CACM,UAACC,CAAD,EAAO;;AAEX,WAAON,GAAG;AACRP,YAAMa,CADE;AAERC,YAAMZ,2BAA2BW,EAAEV,GAA7B;AAFE,KAAH,CAAP;AAID,GAPD;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACD;;AAED,SAASD,0BAAT,CAAqCI,GAArC,EAAiE;AAAA,MAAvBS,UAAuB,uEAAV,IAAU;AAAA,MAAJR,EAAI;;AAC/D;AACA;AACA,MAAIS,IAAI,EAAR;AACAzB,SAAOmB,GAAP,CAAWZ,KAAX,CAAiBQ,GAAjB,EAAsBG,UAAtB,CAAiCQ,IAAjC,CAAsC,UAACA,IAAD,EAAU;AAC9C,QAAIC,IAAI,EAAR;AACA,QAAIC,KAAK,EAAT;AACA;AACA,WAAOZ,GAAGU,KAAKG,SAAR,CAAP;AACD,GALD;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACD;;AAED,SAASC,kBAAT,CAA6BC,OAA7B,EAAsC,CAErC;;AAED,SAASC,QAAT,CAAmBC,EAAnB,EAAuBhB,IAAvB,EAA6B,CAAE;;AAE/B,SAASiB,YAAT,CAAuBD,EAAvB,EAA2BhB,IAA3B,EAAiC,CAAE;;AAEnC,SAASkB,UAAT,GAAuB,CAAE;;AAEzB,SAASC,aAAT,GAA0B,CAAE;;AAE5BC,OAAOC,OAAP,GAAiB;AACfR,wCADe;AAEfS,sBAFe;AAGfjC,wBAHe;AAIfK,wDAJe;AAKfqB,oBALe;AAMfE,4BANe;AAOfC,wBAPe;AAQfC;AARe,CAAjB","file":"voice-service.js","sourcesContent":["'use strict'\nconst client = require('twilio')(process.env.TWILIO_SID, process.env.TWILIO_AUTH_TOKEN)\n\n// const {MessagingResponse, VoiceResponse} = require('twilio').Re\n\nfunction fetchCalls () {\n  //  client.recordings.each(recording => console.log(recording.duration));\n  let calls = []\n  client.calls.each((call) => {\n    let rt = fetchTranscribedRecordings(call.sid)\n    calls.push(rt)\n  })\n  return calls\n}\n\nfunction fetchIncomingCall (cid, cb) {\n  let call = {\n    call: {},\n    from: '',\n    recordings: []\n  }\n  client.api.calls(cid).fetch()\n  .then((c) => {\n\n    return cb({\n      call: c,\n      rtcs: fetchTranscribedRecordings(c.sid)\n    })\n  })\n  // .then((c)=>{\n  //   c.recordings.each(r=> r.transcriptions.each(t=>)\n  // })\n  // client.calls('CA062ccb1bbd7ffc5799f79bf46eef06f0').fetch()\n  // .then((c) => {\n  //   call.call = c\n  // })\n  //\n  // client\n  // .calls(cid)\n  // .fetch()\n  // .then(call => console.log(call.to))\n  // client.calls.get(cid).each((call) => {\n  //   let rt = fetchTranscribedRecordings(call.sid)\n  //   calls.push(rt)\n  // })\n  // return calls\n}\n\nfunction fetchTranscribedRecordings (cid, transcribe = true, cb) {\n  // client.recordings.each(recording => console.log(recording.duration));\n  // client.calls(cid).recordings.each(recording => recording.transcriptions().get()))\n  let x = []\n  client.api.calls(cid).recordings.page((page) => {\n    let r = {}\n    let ts = []\n    // recording.transcriptions.each(t => ts.push(t.transcriptionText))\n    return cb(page.instances)\n  })\n  // let map = {\n  //   cid: cid,\n  //   from: '',\n  //   recordings: []\n  // }\n  //\n  // client.recordings.each({callSid: cid}, (r) => {\n  //   let n = {rid: r.sid, duration: r.duration, uri: r.uri, transcriptions: []}\n  //   if (transcribe)\n  //     r.transcriptions.each(t => n.transcriptions.push({sid: t.sid, uri: t.uri, text: t.transcriptionText}))\n  //   map.recordings.push(n)\n  // })\n  //\n  // return map\n}\n\nfunction onboardNewCallData (callLog) {\n\n}\n\nfunction notifyMe (to, from) {}\n\nfunction notifyServer (to, from) {}\n\nfunction pushNotify () {}\n\nfunction updateCallLog () {}\n\nmodule.exports = {\n  onboardNewCallData,\n  fetchCall,\n  fetchCalls,\n  fetchTranscribedRecordings,\n  notifyMe,\n  notifyServer,\n  pushNotify,\n  updateCallLog\n}"]}