{"version":3,"sources":["../app.js"],"names":["express","require","path","favicon","logger","cookieParser","bodyParser","sassMiddleware","hbs","fs","uuid","session","compression","sslRedirect","app","disable","use","exphbs","create","extname","defaultLayout","helpers","section","name","options","_sections","fn","increment","index","formatDate","date","moment","format","formatDateTime","printCode","code","JSON","stringify","ifCond","v1","operator","v2","inverse","printYesOrNo","isTrue","engine","set","join","__dirname","genid","req","v4","secret","resave","saveUninitialized","cookie","origin","methods","preflightContinue","json","urlencoded","extended","src","dest","indentedSyntax","sourceMap","static","ch","res","next","err","Error","status","locals","message","error","get","render","module","exports"],"mappings":";;AAAA,IAAIA,UAAUC,QAAQ,SAAR,CAAd;AACA,IAAIC,OAAOD,QAAQ,MAAR,CAAX;AACA,IAAIE,UAAUF,QAAQ,eAAR,CAAd;AACA,IAAIG,SAASH,QAAQ,QAAR,CAAb;AACA,IAAII,eAAeJ,QAAQ,eAAR,CAAnB;AACA,IAAIK,aAAaL,QAAQ,aAAR,CAAjB;AACA,IAAIM,iBAAiBN,QAAQ,sBAAR,CAArB;;AAEA,IAAIO,MAAMP,QAAQ,oBAAR,CAAV;AACA,IAAMQ,KAAKR,QAAQ,IAAR,CAAX;AACA,IAAMS,OAAOT,QAAQ,MAAR,CAAb;AACA,IAAMU,UAAUV,QAAQ,iBAAR,CAAhB;AACA,IAAMW,cAAcX,QAAQ,aAAR,CAApB;AACA,IAAIY,cAAcZ,QAAQ,oBAAR,CAAlB;AACA,IAAIa,MAAMd,SAAV;AACA;AACAc,IAAIC,OAAJ,CAAY,cAAZ;AACAD,IAAIE,GAAJ,CAAQJ,aAAR;;AAEA;AACA,IAAIK,SAAST,IAAIU,MAAJ,CAAW;AACtBC,WAAS,KADa,EACNC,eAAe,QADT,EACmBC,SAAS;AAChDC,aAAS,iBAAUC,IAAV,EAAgBC,OAAhB,EAAyB;AAChC,UAAI,CAAC,KAAKC,SAAV,EAAqB;AACnB,aAAKA,SAAL,GAAiB,EAAjB;AACD;AACD,WAAKA,SAAL,CAAeF,IAAf,IAAuBC,QAAQE,EAAR,CAAW,IAAX,CAAvB;AACA,aAAO,IAAP;AACD,KAP+C;AAQhDC,eAAW,mBAAUC,KAAV,EAAiB;AAC1B,aAAOA,QAAQ,CAAf;AACD,KAV+C;AAWhDC,gBAAY,oBAAUC,IAAV,EAAgB;AAC1B,aAAOC,OAAOD,IAAP,EAAaE,MAAb,CAAoB,GAApB,CAAP;AAED,KAd+C;AAehDC,oBAAgB,wBAAUH,IAAV,EAAgB;AAC9B,aAAOC,OAAOD,IAAP,EAAaE,MAAb,CAAoB,KAApB,CAAP;AAED,KAlB+C;AAmBhDE,eAAW,mBAAUC,IAAV,EAAgB;AACzB,aAAOC,KAAKC,SAAL,CAAeF,IAAf,EAAqB,IAArB,EAA2B,CAA3B,CAAP;AACD,KArB+C;AAsBhDG,YAAQ,gBAAUC,EAAV,EAAcC,QAAd,EAAwBC,EAAxB,EAA4BjB,OAA5B,EAAqC;;AAE3C,cAAQgB,QAAR;AACE,aAAK,IAAL;AACE,iBAAQD,MAAME,EAAP,GAAajB,QAAQE,EAAR,CAAW,IAAX,CAAb,GAAgCF,QAAQkB,OAAR,CAAgB,IAAhB,CAAvC;AACF,aAAK,KAAL;AACE,iBAAQH,OAAOE,EAAR,GAAcjB,QAAQE,EAAR,CAAW,IAAX,CAAd,GAAiCF,QAAQkB,OAAR,CAAgB,IAAhB,CAAxC;AACF,aAAK,GAAL;AACE,iBAAQH,KAAKE,EAAN,GAAYjB,QAAQE,EAAR,CAAW,IAAX,CAAZ,GAA+BF,QAAQkB,OAAR,CAAgB,IAAhB,CAAtC;AACF,aAAK,IAAL;AACE,iBAAQH,MAAME,EAAP,GAAajB,QAAQE,EAAR,CAAW,IAAX,CAAb,GAAgCF,QAAQkB,OAAR,CAAgB,IAAhB,CAAvC;AACF,aAAK,GAAL;AACE,iBAAQH,KAAKE,EAAN,GAAYjB,QAAQE,EAAR,CAAW,IAAX,CAAZ,GAA+BF,QAAQkB,OAAR,CAAgB,IAAhB,CAAtC;AACF,aAAK,IAAL;AACE,iBAAQH,MAAME,EAAP,GAAajB,QAAQE,EAAR,CAAW,IAAX,CAAb,GAAgCF,QAAQkB,OAAR,CAAgB,IAAhB,CAAvC;AACF,aAAK,IAAL;AACE,iBAAQH,MAAME,EAAP,GAAajB,QAAQE,EAAR,CAAW,IAAX,CAAb,GAAgCF,QAAQkB,OAAR,CAAgB,IAAhB,CAAvC;AACF,aAAK,IAAL;AACE,iBAAQH,MAAME,EAAP,GAAajB,QAAQE,EAAR,CAAW,IAAX,CAAb,GAAgCF,QAAQkB,OAAR,CAAgB,IAAhB,CAAvC;AACF;AACE,iBAAOlB,QAAQkB,OAAR,CAAgB,IAAhB,CAAP;AAlBJ;AAoBD,KA5C+C;AA6ChDC,kBAAc,sBAAUC,MAAV,EAAkB;AAC9B,aAAQA,MAAD,GAAW,KAAX,GAAmB,IAA1B;AACD;AA/C+C;AAD5B,CAAX,CAAb;AAmDA;AACA9B,IAAI+B,MAAJ,CAAW,KAAX,EAAkB5B,OAAO4B,MAAzB;AACA/B,IAAIgC,GAAJ,CAAQ,OAAR,EAAiB5C,KAAK6C,IAAL,CAAUC,SAAV,EAAqB,OAArB,CAAjB;AACAlC,IAAIgC,GAAJ,CAAQ,aAAR,EAAuB,KAAvB;AACAhC,IAAIgC,GAAJ,CAAQ,aAAR,EAAuB,CAAvB;AACAhC,IAAIE,GAAJ,CAAQL,QAAQ;AACdsC,SAAO,eAAUC,GAAV,EAAe;AACpB,WAAOxC,KAAKyC,EAAL,EAAP,CADoB,CACH;AAClB,GAHa;AAIdC,UAAQ,uBAJM;AAKdC,UAAQ,KALM;AAMdC,qBAAmB,IANL;AAOd;AACAC,UAAQ;AARM,CAAR,CAAR;;AAWAzC,IAAIE,GAAJ,CAAQf,QAAQ,MAAR,EAAgB;AACtBuD,UAAQ,GADc;AAEtBC,WAAS,6BAFa;AAGtBC,qBAAmB;AACnB;AAJsB,CAAhB,CAAR;AAMA;AACA;AACA5C,IAAIE,GAAJ,CAAQZ,OAAO,KAAP,CAAR;AACAU,IAAIE,GAAJ,CAAQV,WAAWqD,IAAX,EAAR;AACA7C,IAAIE,GAAJ,CAAQV,WAAWsD,UAAX,CAAsB,EAACC,UAAU,KAAX,EAAtB,CAAR;AACA/C,IAAIE,GAAJ,CAAQX,cAAR;AACAS,IAAIE,GAAJ,CAAQT,eAAe;AACrBuD,OAAK5D,KAAK6C,IAAL,CAAUC,SAAV,EAAqB,QAArB,CADgB;AAErBe,QAAM7D,KAAK6C,IAAL,CAAUC,SAAV,EAAqB,QAArB,CAFe;AAGrBgB,kBAAgB,IAHK,EAGC;AACtBC,aAAW;AAJU,CAAf,CAAR;AAMAnD,IAAIE,GAAJ,CAAQhB,QAAQkE,MAAR,CAAehE,KAAK6C,IAAL,CAAUC,SAAV,EAAqB,QAArB,CAAf,CAAR;AACA;AACAlC,IAAIE,GAAJ,CAAQhB,QAAQkE,MAAR,CAAehE,KAAK6C,IAAL,CAAUC,SAAV,EAAqB,cAArB,CAAf,CAAR;AACAlC,IAAIE,GAAJ,CAAQhB,QAAQkE,MAAR,CAAehE,KAAK6C,IAAL,CAAUC,SAAV,EAAqB,SAArB,CAAf,CAAR;;AAEAlC,IAAIE,GAAJ,CAAQ,GAAR,EAAaf,QAAQ,gBAAR,CAAb;;AAEAa,IAAIE,GAAJ,CAAQ,YAAR,EAAsBf,QAAQ,oBAAR,CAAtB;AACAa,IAAIE,GAAJ,CAAQ,QAAR,EAAkBf,QAAQ,gBAAR,CAAlB;AACA,IAAIkE,KAAKlE,QAAQ,iBAAR,GAAT;AACA;AACA;AACAa,IAAIE,GAAJ,CAAQ,UAAUkC,GAAV,EAAekB,GAAf,EAAoBC,IAApB,EAA0B;AAChC,MAAIC,MAAM,IAAIC,KAAJ,CAAU,WAAV,CAAV;AACAD,MAAIE,MAAJ,GAAa,GAAb;AACAH,OAAKC,GAAL;AACD,CAJD;;AAMA;AACAxD,IAAIE,GAAJ,CAAQ,UAAUsD,GAAV,EAAepB,GAAf,EAAoBkB,GAApB,EAAyBC,IAAzB,EAA+B;AACrC;AACAD,MAAIK,MAAJ,CAAWC,OAAX,GAAqBJ,IAAII,OAAzB;AACAN,MAAIK,MAAJ,CAAWE,KAAX,GAAmBzB,IAAIpC,GAAJ,CAAQ8D,GAAR,CAAY,KAAZ,MAAuB,aAAvB,GAAuCN,GAAvC,GAA6C,EAAhE;;AAEA;AACAF,MAAII,MAAJ,CAAWF,IAAIE,MAAJ,IAAc,GAAzB;AACAJ,MAAIS,MAAJ,CAAW,OAAX;AACD,CARD;;AAUA5E,QAAQ,UAAR,EAAoB,YAAM,CAEzB,CAFD;;AAIA6E,OAAOC,OAAP,GAAiBjE,GAAjB","file":"app.js","sourcesContent":["var express = require('express')\nvar path = require('path')\nvar favicon = require('serve-favicon')\nvar logger = require('morgan')\nvar cookieParser = require('cookie-parser')\nvar bodyParser = require('body-parser')\nvar sassMiddleware = require('node-sass-middleware')\n\nlet hbs = require('express-handlebars')\nconst fs = require('fs')\nconst uuid = require('uuid')\nconst session = require('express-session')\nconst compression = require('compression')\nvar sslRedirect = require('./lib/ssl-redirect')\nvar app = express()\n// app.use(sslRedirect(['test', 'production']))\napp.disable('x-powered-by')\napp.use(compression())\n\n// view engine setup\nvar exphbs = hbs.create({\n  extname: 'hbs', defaultLayout: 'layout', helpers: {\n    section: function (name, options) {\n      if (!this._sections) {\n        this._sections = {}\n      }\n      this._sections[name] = options.fn(this)\n      return null\n    },\n    increment: function (index) {\n      return index + 1\n    },\n    formatDate: function (date) {\n      return moment(date).format('L')\n\n    },\n    formatDateTime: function (date) {\n      return moment(date).format('LLL')\n\n    },\n    printCode: function (code) {\n      return JSON.stringify(code, null, 2)\n    },\n    ifCond: function (v1, operator, v2, options) {\n\n      switch (operator) {\n        case '==':\n          return (v1 == v2) ? options.fn(this) : options.inverse(this)\n        case '===':\n          return (v1 === v2) ? options.fn(this) : options.inverse(this)\n        case '<':\n          return (v1 < v2) ? options.fn(this) : options.inverse(this)\n        case '<=':\n          return (v1 <= v2) ? options.fn(this) : options.inverse(this)\n        case '>':\n          return (v1 > v2) ? options.fn(this) : options.inverse(this)\n        case '>=':\n          return (v1 >= v2) ? options.fn(this) : options.inverse(this)\n        case '&&':\n          return (v1 && v2) ? options.fn(this) : options.inverse(this)\n        case '||':\n          return (v1 || v2) ? options.fn(this) : options.inverse(this)\n        default:\n          return options.inverse(this)\n      }\n    },\n    printYesOrNo: function (isTrue) {\n      return (isTrue) ? 'Yes' : 'No'\n    }\n  }\n})\n// view engine setup\napp.engine('hbs', exphbs.engine)\napp.set('views', path.join(__dirname, 'views'))\napp.set('view engine', 'hbs')\napp.set('trust proxy', 1)\napp.use(session({\n  genid: function (req) {\n    return uuid.v4() // use UUIDs for session IDs\n  },\n  secret: 'io-room-server-secret',\n  resave: false,\n  saveUninitialized: true,\n  // cookie: { secure: true }\n  cookie: true\n}))\n\napp.use(require('cors')({\n  origin: '*',\n  methods: 'GET,PUT,POST,OPTIONS,DELETE',\n  preflightContinue: true\n  // headers: ['Access-Control-Allow-Origin']\n}))\n// uncomment after placing your favicon in /public\n//app.use(favicon(path.join(__dirname, 'public', 'favicon.ico')));\napp.use(logger('dev'))\napp.use(bodyParser.json())\napp.use(bodyParser.urlencoded({extended: false}))\napp.use(cookieParser())\napp.use(sassMiddleware({\n  src: path.join(__dirname, 'public'),\n  dest: path.join(__dirname, 'public'),\n  indentedSyntax: true, // true = .sass and false = .scss\n  sourceMap: true\n}))\napp.use(express.static(path.join(__dirname, 'public')))\n// app.use(express.static(path.join(__dirname, 'dist')))\napp.use(express.static(path.join(__dirname, 'node_modules')))\napp.use(express.static(path.join(__dirname, 'uploads')))\n\napp.use('/', require('./routes/index'))\n\napp.use('/voicemail', require('./routes/voicemail'))\napp.use('/mebot', require('./routes/mebot'))\nlet ch = require('./lib/callevent')()\n// ch.on('new-call', onboardNewCallData)\n// catch 404 and forward to error handler\napp.use(function (req, res, next) {\n  var err = new Error('Not Found')\n  err.status = 404\n  next(err)\n})\n\n// error handler\napp.use(function (err, req, res, next) {\n  // set locals, only providing error in development\n  res.locals.message = err.message\n  res.locals.error = req.app.get('env') === 'development' ? err : {}\n\n  // render the error page\n  res.status(err.status || 500)\n  res.render('error')\n})\n\nrequire('./lib/db')(() => {\n\n})\n\nmodule.exports = app\n"]}