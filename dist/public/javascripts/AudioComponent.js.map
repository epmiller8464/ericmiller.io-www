{"version":3,"sources":["../../../public/javascripts/AudioComponent.js"],"names":["AudioComponent","options","self","_config","_src","_el","el","_recordingKey","recordingKey","_waveform","waveform","_emitter","EventEmitter","_player","_controls","$play","$pause","$stop","$delete","$status","$duration","_clearAnimationFrame","init","prototype","console","log","howl","src","_","isArray","length","Error","controls","onclick","playClick","pauseClick","stopClick","deleteClick","Howl","once","onLoaded","on","onPlay","onPause","onStop","onError","onEnd","onPlaying","disabled","state","play","textContent","load","pause","stop","destroy","unload","$","ajax","method","url","data","key","done","response","success","innerHTML","message","setTimeout","window","location","href","fail","e","duration","emit","error","arguments","reset","progress","requestAnimationFrame","animateWaveform","find","text","seek","cancelAnimationFrame","event","handler","off","payload"],"mappings":";;AAAA,IAAIA,iBAAiB,SAAjBA,cAAiB,CAAUC,OAAV,EAAmB;AACtC,MAAIC,OAAO,IAAX;AACF;AACEA,OAAKC,OAAL,GAAeF,OAAf;AACAC,OAAKE,IAAL,GAAY,EAAZ;AACAF,OAAKG,GAAL,GAAWJ,QAAQK,EAAnB;AACAJ,OAAKK,aAAL,GAAqBN,QAAQO,YAA7B;AACAN,OAAKO,SAAL,GAAiBR,QAAQS,QAAzB;AACAR,OAAKS,QAAL,GAAgB,IAAIC,YAAJ,EAAhB;AACAV,OAAKW,OAAL,GAAe,EAAf;AACAX,OAAKY,SAAL,GAAiB;AACfC,WAAO,IADQ;AAEfC,YAAQ,IAFO;AAGfC,WAAO,IAHQ;AAIfC,aAAS,IAJM;AAKfC,aAAS,IALM;AAMfC,eAAW;AANI,GAAjB;AAQAlB,OAAKmB,oBAAL,GAA4B,IAA5B;AACAnB,OAAKoB,IAAL,CAAUrB,OAAV;AACA,SAAOC,IAAP;AACD,CArBD;;AAuBAF,eAAeuB,SAAf,GAA2B;AACzBD,QAAM,cAAUrB,OAAV,EAAmB;AACvB,QAAIC,OAAO,IAAX;AACAsB,YAAQC,GAAR,CAAY,gBAAZ;AACA,QAAI,CAACxB,QAAQyB,IAAR,CAAaC,GAAd,IAAqB,CAACC,EAAEC,OAAF,CAAU5B,QAAQyB,IAAR,CAAaC,GAAvB,CAAtB,IAAqD,EAAEC,EAAEC,OAAF,CAAU5B,QAAQyB,IAAR,CAAaC,GAAvB,KAA+B1B,QAAQyB,IAAR,CAAaC,GAAb,CAAiBG,MAAlD,CAAzD,EAAoH;AAClH,YAAM,IAAIC,KAAJ,CAAU,oBAAV,CAAN;AACD;AACD7B,SAAKY,SAAL,CAAeC,KAAf,GAAuBd,QAAQ+B,QAAR,CAAiBjB,KAAxC;AACAb,SAAKY,SAAL,CAAeE,MAAf,GAAwBf,QAAQ+B,QAAR,CAAiBhB,MAAzC;AACAd,SAAKY,SAAL,CAAeG,KAAf,GAAuBhB,QAAQ+B,QAAR,CAAiBf,KAAxC;AACAf,SAAKY,SAAL,CAAeI,OAAf,GAAyBjB,QAAQ+B,QAAR,CAAiBd,OAA1C;AACAhB,SAAKY,SAAL,CAAeK,OAAf,GAAyBlB,QAAQ+B,QAAR,CAAiBb,OAA1C;AACAjB,SAAKY,SAAL,CAAeM,SAAf,GAA2BnB,QAAQ+B,QAAR,CAAiBZ,SAA5C;;AAEAlB,SAAKY,SAAL,CAAeC,KAAf,CAAqBkB,OAArB,GAA+B,YAAY;AAAE/B,WAAKgC,SAAL;AAAkB,KAA/D;AACAhC,SAAKY,SAAL,CAAeE,MAAf,CAAsBiB,OAAtB,GAAgC,YAAY;AAAE/B,WAAKiC,UAAL;AAAmB,KAAjE;AACAjC,SAAKY,SAAL,CAAeG,KAAf,CAAqBgB,OAArB,GAA+B,YAAY;AAAE/B,WAAKkC,SAAL;AAAkB,KAA/D;AACAlC,SAAKY,SAAL,CAAeI,OAAf,CAAuBe,OAAvB,GAAiC,YAAY;AAAE/B,WAAKmC,WAAL;AAAoB,KAAnE;;AAEAnC,SAAKW,OAAL,GAAe,IAAIyB,IAAJ,CAASrC,QAAQyB,IAAjB,CAAf;;AAEAxB,SAAKW,OAAL,CAAa0B,IAAb,CAAkB,MAAlB,EAA0B,YAAY;AAAErC,WAAKsC,QAAL;AAAiB,KAAzD;AACAtC,SAAKW,OAAL,CAAa4B,EAAb,CAAgB,MAAhB,EAAwB,YAAY;AAAEvC,WAAKwC,MAAL;AAAe,KAArD;AACAxC,SAAKW,OAAL,CAAa4B,EAAb,CAAgB,OAAhB,EAAyB,YAAY;AAAEvC,WAAKyC,OAAL;AAAgB,KAAvD;AACAzC,SAAKW,OAAL,CAAa4B,EAAb,CAAgB,MAAhB,EAAwB,YAAY;AAAEvC,WAAK0C,MAAL;AAAe,KAArD;AACA1C,SAAKW,OAAL,CAAa4B,EAAb,CAAgB,WAAhB,EAA6B,YAAY;AAAEvC,WAAK2C,OAAL;AAAgB,KAA3D;AACA3C,SAAKW,OAAL,CAAa4B,EAAb,CAAgB,KAAhB,EAAuB,YAAY;AAAEvC,WAAK4C,KAAL;AAAc,KAAnD;;AAEA5C,SAAKuC,EAAL,CAAQ,SAAR,EAAmBvC,KAAK6C,SAAxB;AACJ;AACA;AACI7C,SAAKY,SAAL,CAAeC,KAAf,CAAqBiC,QAArB,GAAgC,KAAhC;AACA;AACD;AAjCwB,CAA3B;;AAoCAhD,eAAeuB,SAAf,CAAyBW,SAAzB,GAAqC,YAAY;AAC/C,MAAIhC,OAAO,IAAX;AACAsB,UAAQC,GAAR,CAAY,YAAZ;AACA;AACAD,UAAQC,GAAR,CAAYvB,KAAKW,OAAL,CAAaoC,KAAb,EAAZ;AACA,MAAI/C,KAAKW,OAAL,CAAaoC,KAAb,OAAyB,QAA7B,EAAuC;AACrC/C,SAAKW,OAAL,CAAaqC,IAAb;AACD,GAFD,MAEO;AACLhD,SAAKY,SAAL,CAAeK,OAAf,CAAuBgC,WAAvB,GAAqC,SAArC;AACAjD,SAAKW,OAAL,CAAauC,IAAb;AACD;AACF,CAXD;;AAaApD,eAAeuB,SAAf,CAAyBY,UAAzB,GAAsC,YAAY;AAChD,MAAIjC,OAAO,IAAX;AACAA,OAAKW,OAAL,CAAawC,KAAb;AACD,CAHD;;AAKArD,eAAeuB,SAAf,CAAyBa,SAAzB,GAAqC,YAAY;AAC/C,MAAIlC,OAAO,IAAX;AACAA,OAAKW,OAAL,CAAayC,IAAb;AACApD,OAAKqD,OAAL;AACD,CAJD;;AAMAvD,eAAeuB,SAAf,CAAyBc,WAAzB,GAAuC,YAAY;AACjD,MAAInC,OAAO,IAAX;AACAA,OAAKW,OAAL,CAAayC,IAAb;AACApD,OAAKW,OAAL,CAAa2C,MAAb;AACA;AACA,MAAIhD,eAAeN,KAAKK,aAAxB;AACAiB,UAAQC,GAAR,CAAY,qBAAZ,EAAmCjB,YAAnC;AACAiD,IAAEC,IAAF,CAAO;AACLC,YAAQ,QADH;AAELC,SAAK,iBAAiBpD,YAFjB;AAGLqD,UAAM,EAACC,KAAKtD,YAAN;AAHD,GAAP,EAKCuD,IALD,CAKM,UAAUC,QAAV,EAAoB;AACxB,QAAIA,SAASC,OAAb,EAAsB;AACpB/D,WAAKY,SAAL,CAAeK,OAAf,CAAuB+C,SAAvB,GAAmCF,SAASG,OAAT,GAAmB,4EAAtD;AACAC,iBAAW,YAAY;AAACC,eAAOC,QAAP,CAAgBC,IAAhB,GAAuBF,OAAOC,QAAP,CAAgBC,IAAvC;AAA4C,OAApE,EAAsE,IAAtE;AACD,KAHD,MAGO;AACL/C,cAAQC,GAAR,CAAYuC,QAAZ;AACD;AACF,GAZD,EAYGQ,IAZH,CAYQ,UAAUC,CAAV,EAAa;AACnBjD,YAAQC,GAAR,CAAYgD,CAAZ;AAED,GAfD;AAgBD,CAvBD;;AAyBAzE,eAAeuB,SAAf,CAAyBiB,QAAzB,GAAoC,YAAY;AAC9C,MAAItC,OAAO,IAAX;AACA;AACA;AACAA,OAAKY,SAAL,CAAeM,SAAf,CAAyB+B,WAAzB,GAAuCjD,KAAKW,OAAL,CAAa6D,QAAb,MAA2B,CAAlE;AACAxE,OAAKW,OAAL,CAAaqC,IAAb;AACD,CAND;;AAQAlD,eAAeuB,SAAf,CAAyBmB,MAAzB,GAAkC,YAAY;AAC5C,MAAIxC,OAAO,IAAX;AACAA,OAAKY,SAAL,CAAeC,KAAf,CAAqBiC,QAArB,GAAgC,IAAhC;AACA9C,OAAKY,SAAL,CAAeE,MAAf,CAAsBgC,QAAtB,GAAiC,KAAjC;AACA9C,OAAKY,SAAL,CAAeG,KAAf,CAAqB+B,QAArB,GAAgC,KAAhC;AACA;AACA9C,OAAKY,SAAL,CAAeK,OAAf,CAAuBgC,WAAvB,GAAqC,SAArC;AACA;AACAjD,OAAKyE,IAAL,CAAU,SAAV,EAAqBzE,IAArB;AACD,CATD;;AAWAF,eAAeuB,SAAf,CAAyBsB,OAAzB,GAAmC,YAAY;AAC7CrB,UAAQoD,KAAR,CAAcC,SAAd;AAED,CAHD;;AAKA7E,eAAeuB,SAAf,CAAyBoB,OAAzB,GAAmC,YAAY;AAC7C,MAAIzC,OAAO,IAAX;AACAA,OAAKY,SAAL,CAAeC,KAAf,CAAqBiC,QAArB,GAAgC,KAAhC;AACA9C,OAAKY,SAAL,CAAeE,MAAf,CAAsBgC,QAAtB,GAAiC,IAAjC;AACA9C,OAAKY,SAAL,CAAeG,KAAf,CAAqB+B,QAArB,GAAgC,IAAhC;AACA9C,OAAKY,SAAL,CAAeK,OAAf,CAAuBgC,WAAvB,GAAqC,QAArC;AACD,CAND;;AAQAnD,eAAeuB,SAAf,CAAyBqB,MAAzB,GAAkC,YAAY;AAC5CpB,UAAQC,GAAR,CAAY,UAAZ;AACA,MAAIvB,OAAO,IAAX;AACAA,OAAKY,SAAL,CAAeC,KAAf,CAAqBiC,QAArB,GAAgC,KAAhC;AACA9C,OAAKY,SAAL,CAAeE,MAAf,CAAsBgC,QAAtB,GAAiC,IAAjC;AACA9C,OAAKY,SAAL,CAAeG,KAAf,CAAqB+B,QAArB,GAAgC,IAAhC;AACA9C,OAAKY,SAAL,CAAeK,OAAf,CAAuBgC,WAAvB,GAAqC,SAArC;AACAjD,OAAK4E,KAAL;AACAtD,UAAQC,GAAR,CAAY,gBAAZ;AACD,CATD;;AAWAzB,eAAeuB,SAAf,CAAyBuB,KAAzB,GAAiC,YAAY;AAC3CtB,UAAQC,GAAR,CAAY,WAAZ;AACA,MAAIvB,OAAO,IAAX;AACAA,OAAKY,SAAL,CAAeK,OAAf,CAAuBgC,WAAvB,GAAqC,MAArC;AACAjD,OAAKY,SAAL,CAAeM,SAAf,CAAyB+B,WAAzB,GAAuCjD,KAAKW,OAAL,CAAa6D,QAAb,MAA2B,CAAlE;AACD,CALD;;AAOA1E,eAAeuB,SAAf,CAAyBwD,QAAzB,GAAoC,YAAY;AAC9C,MAAI7E,OAAO,IAAX;AACD,CAFD;;AAIAF,eAAeuB,SAAf,CAAyBwB,SAAzB,GAAqC,UAAU7C,IAAV,EAAgB;AACnD;AACAsB,UAAQC,GAAR,CAAY,SAAZ;AACA;AACAvB,OAAKmB,oBAAL,GAA4BgD,OAAOW,qBAAP,CAA6B,YAAY;AAAC9E,SAAK+E,eAAL;AAAuB,GAAjE,CAA5B;AACD,CALD;;AAOAjF,eAAeuB,SAAf,CAAyB0D,eAAzB,GAA2C,YAAY;AACrD,MAAI/E,OAAO,IAAX;AACAuD,IAAEA,EAAEvD,KAAKG,GAAP,EAAY6E,IAAZ,CAAiB,WAAjB,EAA8B,CAA9B,CAAF,EAAoCC,IAApC,CAA0CjF,KAAKW,OAAL,CAAa6D,QAAb,KAA2BxE,KAAKW,OAAL,CAAauE,IAAb,EAA5B,IAAqD,CAA9F;AACA;AACAlF,OAAKmB,oBAAL,GAA4BgD,OAAOW,qBAAP,CAA6B,YAAY;AAAC9E,SAAK+E,eAAL;AAAuB,GAAjE,CAA5B;AACD,CALD;;AAOAjF,eAAeuB,SAAf,CAAyBgC,OAAzB,GAAmC,YAAY;AAC7C,MAAIrD,OAAO,IAAX;AAED,CAHD;;AAKAF,eAAeuB,SAAf,CAAyBuD,KAAzB,GAAiC,YAAY;AAC3C,MAAI5E,OAAO,IAAX;AACA;AACAmE,SAAOgB,oBAAP,CAA4BnF,KAAKmB,oBAAjC;AAED,CALD;;AAOArB,eAAeuB,SAAf,CAAyBkB,EAAzB,GAA8B,UAAU6C,KAAV,EAAiBC,OAAjB,EAA0B;AACtD,MAAIrF,OAAO,IAAX;AACA,SAAOA,KAAKS,QAAL,CAAc8B,EAAd,CAAiB6C,KAAjB,EAAwBC,OAAxB,EAAiC,IAAjC,CAAP;AAED,CAJD;;AAMAvF,eAAeuB,SAAf,CAAyBiE,GAAzB,GAA+B,UAAUF,KAAV,EAAiBC,OAAjB,EAA0B;AACvD,MAAIrF,OAAO,IAAX;AACA,SAAOA,KAAKS,QAAL,CAAc6E,GAAd,CAAkBF,KAAlB,EAAyBC,OAAzB,EAAkC,IAAlC,CAAP;AACD,CAHD;;AAKAvF,eAAeuB,SAAf,CAAyBoD,IAAzB,GAAgC,UAAUW,KAAV,EAAiBG,OAAjB,EAA0B;AACxD,MAAIvF,OAAO,IAAX;AACA,SAAOA,KAAKS,QAAL,CAAcgE,IAAd,CAAmBW,KAAnB,EAA0BG,OAA1B,CAAP;AAED,CAJD","file":"AudioComponent.js","sourcesContent":["var AudioComponent = function (options) {\n  var self = this\n//            EventEmitter.call(self)\n  self._config = options\n  self._src = []\n  self._el = options.el\n  self._recordingKey = options.recordingKey\n  self._waveform = options.waveform\n  self._emitter = new EventEmitter()\n  self._player = {}\n  self._controls = {\n    $play: null,\n    $pause: null,\n    $stop: null,\n    $delete: null,\n    $status: null,\n    $duration: null\n  }\n  self._clearAnimationFrame = null\n  self.init(options)\n  return self\n}\n\nAudioComponent.prototype = {\n  init: function (options) {\n    var self = this\n    console.log('initialization')\n    if (!options.howl.src || !_.isArray(options.howl.src) || !(_.isArray(options.howl.src) && options.howl.src.length)) {\n      throw new Error('no src files found')\n    }\n    self._controls.$play = options.controls.$play\n    self._controls.$pause = options.controls.$pause\n    self._controls.$stop = options.controls.$stop\n    self._controls.$delete = options.controls.$delete\n    self._controls.$status = options.controls.$status\n    self._controls.$duration = options.controls.$duration\n\n    self._controls.$play.onclick = function () { self.playClick() }\n    self._controls.$pause.onclick = function () { self.pauseClick() }\n    self._controls.$stop.onclick = function () { self.stopClick() }\n    self._controls.$delete.onclick = function () { self.deleteClick() }\n\n    self._player = new Howl(options.howl)\n\n    self._player.once('load', function () { self.onLoaded() })\n    self._player.on('play', function () { self.onPlay() })\n    self._player.on('pause', function () { self.onPause() })\n    self._player.on('stop', function () { self.onStop() })\n    self._player.on('loaderror', function () { self.onError() })\n    self._player.on('end', function () { self.onEnd() })\n\n    self.on('playing', self.onPlaying)\n//                $($(self._el).children('button.pause')[0]).click(self.pause)\n//                $($(self._el).children('button.stop')[0]).click(self.stop)\n    self._controls.$play.disabled = false\n    // $($(self._el).find('.status')[0]).text('listo!')\n  }\n}\n\nAudioComponent.prototype.playClick = function () {\n  var self = this\n  console.log('play click')\n  // console.log('loading')\n  console.log(self._player.state())\n  if (self._player.state() === 'loaded') {\n    self._player.play()\n  } else {\n    self._controls.$status.textContent = 'Loading'\n    self._player.load()\n  }\n}\n\nAudioComponent.prototype.pauseClick = function () {\n  var self = this\n  self._player.pause()\n}\n\nAudioComponent.prototype.stopClick = function () {\n  var self = this\n  self._player.stop()\n  self.destroy()\n}\n\nAudioComponent.prototype.deleteClick = function () {\n  var self = this\n  self._player.stop()\n  self._player.unload()\n  // self.destroy()\n  var recordingKey = self._recordingKey\n  console.log('deleting record: %s', recordingKey)\n  $.ajax({\n    method: 'DELETE',\n    url: '/voice-mail/' + recordingKey,\n    data: {key: recordingKey}\n  })\n  .done(function (response) {\n    if (response.success) {\n      self._controls.$status.innerHTML = response.message + '<br/> <b class=\"text-warning\">The page will reload in a few seconds...</b>'\n      setTimeout(function () {window.location.href = window.location.href}, 3000)\n    } else {\n      console.log(response)\n    }\n  }).fail(function (e) {\n    console.log(e)\n\n  })\n}\n\nAudioComponent.prototype.onLoaded = function () {\n  var self = this\n  // $($(self._el).find('.duration')[0]).text(self._player.duration() >> 0)\n  // $(self._controls.$duration).text(self._player.duration() >> 0)\n  self._controls.$duration.textContent = self._player.duration() >> 0\n  self._player.play()\n}\n\nAudioComponent.prototype.onPlay = function () {\n  var self = this\n  self._controls.$play.disabled = true\n  self._controls.$pause.disabled = false\n  self._controls.$stop.disabled = false\n  // $($(self._el).find('.status')[0]).text('playing')\n  self._controls.$status.textContent = 'Playing'\n  // $(self._controls.$status).text('playing')\n  self.emit('playing', self)\n}\n\nAudioComponent.prototype.onError = function () {\n  console.error(arguments)\n\n}\n\nAudioComponent.prototype.onPause = function () {\n  var self = this\n  self._controls.$play.disabled = false\n  self._controls.$pause.disabled = true\n  self._controls.$stop.disabled = true\n  self._controls.$status.textContent = 'Paused'\n}\n\nAudioComponent.prototype.onStop = function () {\n  console.log('stopped!')\n  var self = this\n  self._controls.$play.disabled = false\n  self._controls.$pause.disabled = true\n  self._controls.$stop.disabled = true\n  self._controls.$status.textContent = 'Stopped'\n  self.reset()\n  console.log('reset controls')\n}\n\nAudioComponent.prototype.onEnd = function () {\n  console.log('Finished!')\n  var self = this\n  self._controls.$status.textContent = 'Done'\n  self._controls.$duration.textContent = self._player.duration() >> 0\n}\n\nAudioComponent.prototype.progress = function () {\n  var self = this\n}\n\nAudioComponent.prototype.onPlaying = function (self) {\n  // var self = this\n  console.log('Playing')\n  // self._clearAnimationFrame = setInterval(function () {self.animateWaveform()}, 500)\n  self._clearAnimationFrame = window.requestAnimationFrame(function () {self.animateWaveform()})\n}\n\nAudioComponent.prototype.animateWaveform = function () {\n  var self = this\n  $($(self._el).find('.duration')[0]).text((self._player.duration() - (self._player.seek())) >> 0)\n  // console.log(self._player.duration() - (self._player.seek()))\n  self._clearAnimationFrame = window.requestAnimationFrame(function () {self.animateWaveform()})\n}\n\nAudioComponent.prototype.destroy = function () {\n  var self = this\n\n}\n\nAudioComponent.prototype.reset = function () {\n  var self = this\n  // clearInterval(self._clearAnimationFrame)\n  window.cancelAnimationFrame(self._clearAnimationFrame)\n\n}\n\nAudioComponent.prototype.on = function (event, handler) {\n  var self = this\n  return self._emitter.on(event, handler, true)\n\n}\n\nAudioComponent.prototype.off = function (event, handler) {\n  var self = this\n  return self._emitter.off(event, handler, true)\n}\n\nAudioComponent.prototype.emit = function (event, payload) {\n  var self = this\n  return self._emitter.emit(event, payload)\n\n}"]}