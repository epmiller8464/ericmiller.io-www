{"version":3,"sources":["../../../public/javascripts/Audio-Bundle.js"],"names":["context","window","AudioContext","webkitAudioContext","createGain","createGainNode","createDelay","createDelayNode","createScriptProcessor","createJavaScriptNode","requestAnimFrame","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","setTimeout","socketio","io","mediaStream","on","startRecording","disabled","currentTime","document","getElementById","stopRecording","playButton","saveRecordingButton","cameraPreview","progressBar","querySelector","percentage","liveAudioCanvas","playbackAudioCanvas","recordAudio","recordVideo","sample","liveSample","BufferLoader","urlList","onload","bufferList","Array","loadCount","prototype","loadBuffer","url","index","request","XMLHttpRequest","open","responseType","loader","decodeAudioData","response","buffer","alert","length","error","console","onerror","send","load","i","bytesToSize","bytes","k","sizes","parseInt","Math","floor","log","pow","toPrecision","playSound","time","source","createBufferSource","connect","destination","start","loadSounds","obj","soundMap","names","paths","name","path","push","bufferLoader","_clearInterval","MAXRECORDTIME","WIDTH","HEIGHT","SMOOTHING","FFT_SIZE","WebVoiceMail","config","cb","input","createMediaStreamSource","filter","createBiquadFilter","frequency","value","type","Q","analyser","createAnalyser","freqs","Uint8Array","frequencyBinCount","times","sampleBuffer","isLive","startTime","startOffset","maxTime","canvas","recording","audioSignature","_cancelAnimation","togglePlayback","play","loop","duration","onEnded","draw","bind","stop","disconnect","src","captureCanvasImage","cancelAnimationFrame","e","endRecording","timestamp","smoothingTimeConstant","fftSize","getByteFrequencyData","getByteTimeDomainData","width","drawContext","getContext","height","t","percent","offset","barWidth","hue","fillStyle","fillRect","getFrequencyValue","freq","nyquist","sampleRate","round","VisualizerSample","monitorTime","onError","onStreamError","image","toDataURL","$","prop","minDecibels","maxDecibels","onLoaded","text","isPlaying","initAudio","navigator","audioContextSignature","token","onclick","addClass","getUserMedia","audio","video","stream","RecordRTC","recorderType","StereoAudioRecorder","onAudioProcessStarted","URL","createObjectURL","muted","controls","showProgress","setRecordingDuration","recordingDuration","JSON","stringify","imageCaptured","Date","now","diff","current","recordingKey","fileName","removeClass","emit","filename","id","payload","_fileName","key","href","location","split","pop","replace","result","parentNode","style","display","call","phone_number","poster","getDataURL","audioDataURL","files","getBlob","dataURL","waveForm","createDate","moment","format"],"mappings":"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","file":"Audio-Bundle.js","sourcesContent":["context = new (window.AudioContext || window.webkitAudioContext || webkitAudioContext)()\n\nif (!context.createGain) { context.createGain = context.createGainNode }\nif (!context.createDelay) { context.createDelay = context.createDelayNode }\nif (!context.createScriptProcessor) { context.createScriptProcessor = context.createJavaScriptNode }\n\n// shim layer with setTimeout fallback\nwindow.requestAnimFrame = (function () {\n  return window.requestAnimationFrame ||\n    window.webkitRequestAnimationFrame ||\n    window.mozRequestAnimationFrame ||\n    window.oRequestAnimationFrame ||\n    window.msRequestAnimationFrame ||\n    function (callback) {\n      window.setTimeout(callback, 1000 / 60)\n    }\n})()\n\nvar socketio = io()\nvar mediaStream = null\nsocketio.on('connect', function () {\n  startRecording.disabled = false\n})\nvar currentTime = 0\nvar startRecording = document.getElementById('record-btn')\nvar stopRecording = document.getElementById('stop-recording-btn')\nvar playButton = document.getElementById('play-btn')\nvar saveRecordingButton = document.getElementById('upload-btn')\nvar cameraPreview = document.getElementById('camera-preview')\nvar progressBar = document.querySelector('#progress-bar')\nvar percentage = document.querySelector('#percentage')\nvar liveAudioCanvas = document.querySelector('#live-audio-canvas')\nvar playbackAudioCanvas = document.querySelector('#playback-audio-canvas')\nvar recordAudio\nvar recordVideo\nvar sample\nvar liveSample\n\nfunction BufferLoader (context, urlList, callback) {\n  this.context = context\n  this.urlList = urlList\n  this.onload = callback\n  this.bufferList = new Array()\n  this.loadCount = 0\n}\n\nBufferLoader.prototype.loadBuffer = function (url, index) {\n  // Load buffer asynchronously\n  var request = new XMLHttpRequest()\n  //console.log(url)\n  request.open('GET', url, true)\n  request.responseType = 'arraybuffer'\n\n  var loader = this\n\n  request.onload = function () {\n    // Asynchronously decode the audio file data in request.response\n    loader.context.decodeAudioData(\n      request.response,\n      function (buffer) {\n        if (!buffer) {\n          alert('error decoding file data: ' + url)\n          return\n        }\n        loader.bufferList[index] = buffer\n        if (++loader.loadCount == loader.urlList.length) { loader.onload(loader.bufferList) }\n      },\n      function (error) {\n        console.error('decodeAudioData error', error)\n      }\n    )\n  }\n\n  request.onerror = function () {\n    alert('BufferLoader: XHR error')\n  }\n\n  request.send()\n}\n\nBufferLoader.prototype.load = function () {\n  for (var i = 0; i < this.urlList.length; ++i) { this.loadBuffer(this.urlList[i], i) }\n}\n\nfunction bytesToSize (bytes) {\n  var k = 1000\n  var sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB']\n  if (bytes === 0) {\n    return '0 Bytes'\n  }\n  var i = parseInt(Math.floor(Math.log(bytes) / Math.log(k)), 10)\n  return (bytes / Math.pow(k, i)).toPrecision(3) + ' ' + sizes[i]\n}\n\nfunction playSound (buffer, time) {\n  var source = context.createBufferSource()\n  source.buffer = buffer\n  source.connect(context.destination)\n  source[source.start ? 'start' : 'noteOn'](time)\n}\n\nfunction loadSounds (obj, soundMap, callback) {\n  // Array-ify\n  var names = []\n  var paths = []\n  for (var name in soundMap) {\n    var path = soundMap[name]\n    names.push(name)\n    paths.push(path)\n  }\n  var bufferLoader = new BufferLoader(context, paths, function (bufferList) {\n    for (var i = 0; i < bufferList.length; i++) {\n      var buffer = bufferList[i]\n      var name = names[i]\n      obj[name] = buffer\n    }\n    if (callback) {\n      callback()\n    }\n  })\n  bufferLoader.load()\n}\n\n/*\n * Copyright 2013 Boris Smus. All Rights Reserved.\n\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar _clearInterval\nvar MAXRECORDTIME = 45000\n\nvar WIDTH = 640\nvar HEIGHT = 130\n\n// Interesting parameters to tweak!\nvar SMOOTHING = 0.85\n// var FFT_SIZE = 2048 << 0x01\nvar FFT_SIZE = 1024\n\n// var FFT_SIZE = 2048 / 2\n\nfunction WebVoiceMail (config, cb) {\n  this.mediaStream = config.source\n  this.input = context.createMediaStreamSource(this.mediaStream)\n  // Connect the input to a filter.\n  this.filter = context.createBiquadFilter()\n  this.filter.frequency.value = 60.0\n  this.filter.type = 'notch'\n  this.filter.Q = 10.0\n\n  this.analyser = context.createAnalyser()\n  // Connect graph.\n  this.input.connect(this.filter)\n  this.filter.connect(this.analyser)\n\n  this.freqs = new Uint8Array(this.analyser.frequencyBinCount)\n  this.times = new Uint8Array(this.analyser.frequencyBinCount)\n  this.sampleBuffer = new Uint8Array(this.analyser.frequencyBinCount)\n  this.isLive = true\n  this.startTime = 0\n  this.startOffset = 0\n  this.maxTime = 45000\n  this.index = 0\n  this.canvas = config.canvas\n  this.recording = false\n  this.audioSignature = null\n  this._cancelAnimation\n  return this\n}\n\n// Toggle playback\nWebVoiceMail.prototype.togglePlayback = function () {\n  this.play()\n}\n\nWebVoiceMail.prototype.play = function () {\n  // $('#rerecord').prop('disabled', true)\n  // this.stop()\n\n  this.startTime = context.currentTime\n  //console.log('started at', this.startOffset)\n  this.source = context.createBufferSource()\n  // Connect graph\n  this.source.connect(this.analyser)\n  this.source.buffer = this.buffer\n  this.source.loop = false\n  // Start playback, but make sure we stay in bound of the buffer.\n  this.source[this.source.start ? 'start' : 'noteOn'](0, this.startOffset % this.buffer.duration)\n  // Start visualizer.\n  this.isLive = true\n\n  this.source.onEnded = this.onEnded\n  this._cancelAnimation = requestAnimationFrame(this.draw.bind(this))\n}\n\nWebVoiceMail.prototype.stop = function () {\n//   if (this.isLive) {\n  try {\n    // this.source[this.source.stop ? 'stop' : 'noteOff'](0)\n    this.recording = false\n    // this.siriWave.stop()\n    this.mediaStream.stop()\n    this.input.disconnect(0)\n    this.filter.disconnect(0)\n    cameraPreview.src = ''\n    // cameraPreview.stop()\n    this.captureCanvasImage()\n    this.startOffset = 0// += context.currentTime - this.startTime\n    //console.log('stopped at', context.currentTime)\n    cancelAnimationFrame(this._cancelAnimation)\n  } catch (e) {\n  }\n\n  this.startOffset = 0\n  this.isLive = false\n}\n\nWebVoiceMail.prototype.disconnect = function () {\n  this.stop()\n  this.input.disconnect(0)\n  this.startOffset = 0\n}\n\nWebVoiceMail.prototype.onEnded = function () {\n  // alert()\n  // this.captureCanvasImage()\n\n  // clearInterval(_clearInterval)\n  endRecording()\n}\nvar time = 0\nWebVoiceMail.prototype.draw = function (timestamp) {\n  this.analyser.smoothingTimeConstant = SMOOTHING\n  this.analyser.fftSize = FFT_SIZE / 4\n\n  // Get the frequency data from the currently live stream\n  this.analyser.getByteFrequencyData(this.freqs)\n  this.analyser.getByteTimeDomainData(this.times)\n\n  var width = Math.floor(1 / this.freqs.length, 10)\n  // var width = Math.floor(1 / this.freqs.length, 10)\n\n  // var canvas = document.querySelector('canvas')\n  var drawContext = this.canvas.getContext('2d')\n\n  this.canvas.width = WIDTH\n  this.canvas.height = HEIGHT\n  // Draw the frequency domain chart.\n  var t = 0\n\n  for (var i = 0; i < this.analyser.frequencyBinCount; i++) {\n    var value = this.freqs[i]\n    var percent = value / 256\n    // var height = value * (value * percent)\n    var height = HEIGHT * percent\n    var offset = HEIGHT - height - 1\n    var barWidth = WIDTH / this.analyser.frequencyBinCount\n    // var barWidth = this.freqs.length / this.analyser.frequencyBinCount\n    var hue = i / this.analyser.frequencyBinCount * 360\n    drawContext.fillStyle = 'hsl(' + hue + ', 100%, 50%)'\n    if (!this.recording) {\n      drawContext.fillRect((i * barWidth) * 1, offset * 0.5, 1.5, (height / 2) > 0 ? (height / 2) : 1)\n    } else {\n      drawContext.fillRect((i * barWidth) * 1, offset, 1.5, 1)\n    }\n    t += value// (height / 2) > 0 ? (height / 2) : 1\n  }\n  this.sampleBuffer[i] += this.getFrequencyValue(t / this.analyser.frequencyBinCount)\n  // this.sampleBuffer[i] = this.getFrequencyValue(t / this.analyser.frequencyBinCount)\n  // this.index++\n  // Draw the time domain chart.\n  for (var i = 0; i < this.analyser.frequencyBinCount; i++) {\n    var value = this.sampleBuffer[i] / 2\n    var percent = value / 256\n    var height = HEIGHT * percent\n    var offset = HEIGHT - height - 1\n    var barWidth = WIDTH / this.analyser.frequencyBinCount\n    // drawContext.fillStyle = 'rgba(233,233,233,0.5)'\n    // var hue = i / this.sampleBuffer.length * 360\n    var hue = i / this.analyser.frequencyBinCount * 360\n\n    drawContext.fillStyle = 'hsl(' + hue + ', 100%, 50%)'\n    drawContext.fillRect(i * (this.canvas.width / 100), HEIGHT - height, 2, height > 0 ? height : 1)\n    // drawContext.fillRect(i * (this.canvas.width / 100), HEIGHT - value, 2, this.sampleBuffer[i] > 2 ? (this.sampleBuffer[i]) : 2)\n    // drawContext.fillRect(i * barWidth, offset, barWidth, 2)\n    // drawContext.fillRect(i * barWidth, offset, barWidth, height)\n    //\n  }\n\n// this.sampleBuffer.push()\n  if (this.isLive) {\n    this._cancelAnimation = requestAnimationFrame(this.draw.bind(this))\n  }\n}\n\nWebVoiceMail.prototype.getFrequencyValue = function (freq) {\n  var nyquist = context.sampleRate / 2\n  var index = Math.round(freq / nyquist * this.freqs.length)\n  return this.freqs[index]\n}\n\nVisualizerSample.prototype.monitorTime = function () {\n  //console.log('context time: %s, buffer duration', context.currentTime, this.buffer.duration)\n\n  // requestAnimationFrame(this.time.bind(this))\n}\n\nWebVoiceMail.prototype.sample = function (time) {\n\n  var freqs = new Uint8Array(this.analyser.frequencyBinCount)\n  var times = new Uint8Array(this.analyser.frequencyBinCount)\n  var t = 0\n  for (var i = 0; i < this.analyser.frequencyBinCount; i++) {\n    var value = freqs[i]\n    // value = this.getFrequencyValue(value)//[i]\n    var percent = value / 256\n    var height = HEIGHT * percent\n    // var offset = HEIGHT - height - 1\n    // var barWidth = WIDTH / this.analyser.frequencyBinCount\n    // // var barWidth = this.freqs.length / this.analyser.frequencyBinCount\n    // var hue = i / this.analyser.frequencyBinCount * 360\n    // drawContext.fillStyle = 'hsl(' + hue + ', 100%, 50%)'\n    // drawContext.fillRect((i * barWidth) * 1.5, offset * 0.5, 2, (height + 0.25))\n    t += height\n  }\n  this.sampleBuffer[time] = this.getFrequencyValue(t / this.analyser.frequencyBinCount)\n  this.index++\n  // var sampleRate = context.sampleRate\n  // var index = Math.round(freq / sampleRate * this.freqs.length)\n  // return this.freqs[index]\n}\n\nWebVoiceMail.prototype.onError = function onStreamError (e) {\n  console.error(e)\n}\nvar image\nWebVoiceMail.prototype.captureCanvasImage = function () {\n  // this.canvas\n  image = this.canvas.toDataURL('image/png')\n  $('#snapshot').prop('src', image)\n}\n\nfunction VisualizerSample (config, cb) {\n  this.analyser = context.createAnalyser()\n\n  this.analyser.connect(context.destination)\n  this.analyser.minDecibels = config.minDecibels || -140\n  this.analyser.maxDecibels = config.maxDecibels || 0\n  loadSounds(this, {\n    buffer: config.source\n  }, onLoaded)\n  this.freqs = new Uint8Array(this.analyser.frequencyBinCount)\n  this.times = new Uint8Array(this.analyser.frequencyBinCount)\n\n  function onLoaded () {\n    // var button = document.querySelector('button')\n    // button.removeAttribute('disabled')\n    $('#playback-click').text('Play/pause')\n    $('#playback-click').prop('disabled', false)\n\n    return cb()\n  }\n\n  this.isPlaying = false\n  this.startTime = 0\n  this.startOffset = 0\n  this.index = 0\n  this.canvas = config.canvas\n}\n\n// Toggle playback\nVisualizerSample.prototype.togglePlayback = function () {\n  this.play()\n}\n\nVisualizerSample.prototype.play = function () {\n  // $('#rerecord').prop('disabled', true)\n  this.stop()\n\n  this.startTime = context.currentTime\n  // ////console.log('started at', this.startOffset)\n  this.source = context.createBufferSource()\n  // Connect graph\n  this.source.onEnded = this.onEnded\n  this.source.connect(this.analyser)\n  this.source.buffer = this.buffer\n  this.source.loop = false\n  // Start playback, but make sure we stay in bound of the buffer.\n  this.source[this.source.start ? 'start' : 'noteOn'](0, this.startOffset % this.buffer.duration)\n  // ////console.log('duration: ', this.buffer.duration)\n  // Start visualizer.\n  this.isPlaying = true\n  this.draw()\n  this.time()\n}\n\nVisualizerSample.prototype.time = function () {\n  // //console.log('context time: %s, buffer duration', context.currentTime, this.buffer.duration)\n\n  // requestAnimationFrame(this.time.bind(this))\n}\n\nVisualizerSample.prototype.stop = function () {\n//   if (this.isPlaying) {\n  try {\n    this.source[this.source.stop ? 'stop' : 'noteOff'](0)\n    this.startOffset += context.currentTime - this.startTime\n    //console.log('paused at', this.startOffset)\n  } catch (e) {\n\n  }\n//   }\n  this.startOffset = 0\n  this.isPlaying = false\n}\n\nVisualizerSample.prototype.disconnect = function () {\n  this.stop()\n  this.source.disconnect(0)\n  this.startOffset = 0\n}\n\nVisualizerSample.prototype.onEnded = function () {\n  //console.log('stopping...')\n  this.stop()\n  // $('#rerecord').prop('disabled', false)\n  alert('done')\n}\n\nVisualizerSample.prototype.draw = function () {\n  this.analyser.smoothingTimeConstant = 0.8\n  this.analyser.fftSize = FFT_SIZE / 4\n\n  // Get the frequency data from the currently live stream\n  this.analyser.getByteFrequencyData(this.freqs)\n  this.analyser.getByteTimeDomainData(this.times)\n\n  var width = Math.floor(1 / this.freqs.length, 10)\n  // var width = Math.floor(1 / this.freqs.length, 10)\n\n  // var canvas = document.querySelector('canvas')\n  var drawContext = this.canvas.getContext('2d')\n\n  this.canvas.width = WIDTH * 1.5\n  this.canvas.height = HEIGHT\n  // Draw the frequency domain chart.\n  for (var i = 0; i < this.analyser.frequencyBinCount; i++) {\n    var value = this.freqs[i]\n    // value = this.getFrequencyValue(value);//[i]\n\n    var percent = value / 256\n    var height = HEIGHT * percent\n    var offset = HEIGHT - height - 1\n    var barWidth = WIDTH / this.analyser.frequencyBinCount\n    // var barWidth = this.freqs.length / this.analyser.frequencyBinCount\n    var hue = i / this.analyser.frequencyBinCount * 360\n    drawContext.fillStyle = 'hsl(' + hue + ', 100%, 50%)'\n    drawContext.fillRect((i * barWidth) * 1.5, offset * 0.5, 2, (height + 0.25))\n  }\n\n  // if (this.isPlaying) {\n  // requestAnimationFrame(this.draw.bind(this))\n  // }\n}\nVisualizerSample.prototype.getFrequencyValue = function (freq) {\n  var nyquist = context.sampleRate / 2\n  var index = Math.round(freq / nyquist * this.freqs.length)\n  return this.freqs[index]\n}\n\nif (false /* for Microsoft Edge */) {\n//            cameraPreview.parentNode.innerHTML = '<audio id=\"camera-preview\" controls style=\"border: 1px solid rgb(15, 158, 238); width: 94%;\"></audio> '\n}\n\nfunction initAudio () {\n\n  if (!window.navigator['getUserMedia'])\n    return\n\n  startRecording.disabled = false\n  stopRecording.disabled = true\n  playButton.disabled = true\n  saveRecordingButton.disabled = true\n\n  if (sample) { sample.disconnect() }\n\n  cameraPreview.onEnded = function () { alert('done') }\n}\n\nvar audioSignature = null\n\nfunction audioContextSignature (token) {\n  audioSignature = token\n}\n\nstartRecording.onclick = function () {\n  if (!audioSignature) {\n    $('.status.on').text('No validation token created....').addClass('text-warning')\n  }\n  // initAudio()\n  navigator.getUserMedia({\n    audio: true,\n    video: false\n  }, function (stream) {\n    mediaStream = stream\n    liveSample = new WebVoiceMail({type: 'live-audio', source: stream, canvas: liveAudioCanvas})\n    liveSample.audioSignature = audioSignature\n    liveSample.draw()\n\n    startRecording.disabled = true\n    playButton.disabled = true\n    saveRecordingButton.disabled = true\n    $('.status.on').text('Recording....')\n    liveSample.recording = true\n\n    recordAudio = RecordRTC(liveSample.mediaStream, {\n      type: 'audio',\n      recorderType: StereoAudioRecorder,\n      onAudioProcessStarted: function () {\n        // recordVideo.startRecording()\n        cameraPreview.src = window.URL.createObjectURL(mediaStream)\n        cameraPreview.play()\n        cameraPreview.muted = true\n        cameraPreview.controls = false\n        showProgress()\n        // _clearInterval = setInterval(showProgress, 1000)\n      }\n    })\n    // }\n    recordAudio.setRecordingDuration(45000, liveSample.onEnded)\n    recordAudio.startRecording()\n    currentTime = recordAudio.recordingDuration\n    stopRecording.disabled = false\n\n  }, function (error) {\n    $('.status.on').text('Error:' + JSON.stringify(error)).addClass('text-danger')\n\n    // alert(JSON.stringify(error))\n  })\n\n}\nvar duration = 45\nvar start = null\nvar imageCaptured = false\n\nfunction showProgress (timestamp) {\n  if (!start) {\n    start = Date.now()\n    liveSample.sample(0)\n  }\n  // //console.log()\n  var diff = Date.now() - start\n  var current = (Math.floor(diff) / 500) >> 0\n\n  liveSample.sample(current)\n  if (current !== time) {\n    time = current\n    // //console.log(time, timestamp)\n    $('.time-remaining').text((duration - time) + ' seconds')\n  }\n\n  if (time > (duration / 2) && !imageCaptured) {\n    // liveSample.captureCanvasImage()\n    // imageCaptured = true\n  }\n  // duration--\n  // time += timestamp\n\n _clearInterval = requestAnimationFrame(showProgress)\n\n}\n\nstopRecording.onclick = function () {\n  endRecording()\n  // clearInterval(_clearInterval)\n  cancelAnimationFrame(_clearInterval)\n  // endRecording()\n}\n\nplayButton.onclick = function () {\n  sample.togglePlayback()\n}\nvar recordingKey = null\nvar fileName = null\nsaveRecordingButton.onclick = function () {\n  // $('#start-recording').trigger('click')\n  // sample.togglePlayback()\n  // sample.startOffset = sample.buffer.duration / 2\n  // sample.play()\n  // initAudio()\n  // $.ajax({\n  //   // method: 'POST',\n  //   method: 'DELETE',\n  //   url: '/voicemail/' + recordingKey,\n  //   data: {key: recordingKey, fileName: fileName}\n  // })\n  // .done(function (msg) {\n  //   window.location.href = window.location.href\n  // })\n  $('.status.on').text('Saving and moving to AWS storage...').removeClass('recording')\n\n  socketio.emit('save-upload', {filename: fileName, id: recordingKey, token: liveSample.audioSignature})\n\n  // $.ajax({method:'POST',})\n}\nsocketio.on('uploaded', function (payload) {\n\n  $('.status.on').text('Uploaded...').removeClass('recording')\n  //console.log(payload)\n\n})\n\nsocketio.on('merged', function (payload) {\n  var _fileName = payload.fileName\n  var key = payload.key\n  var id = payload.id\n  var href = (location.href.split('/').pop().length ? location.href.replace(location.href.split('/').pop(), '') : location.href)\n  href = href + 'uploads/' + _fileName\n  //console.log('got file ' + href)\n  sample = new VisualizerSample({source: href, canvas: liveAudioCanvas}, function () {\n    startRecording.disabled = true\n    playButton.disabled = false\n    saveRecordingButton.disabled = false\n    recordingKey = id\n    fileName = _fileName\n    //console.log(key, fileName)\n    // $('#delete-upload-btn').data('recording-key', key)\n  })\n})\n\nsocketio.on('ffmpeg-output', function (result) {\n  if (parseInt(result) >= 100) {\n    progressBar.parentNode.style.display = 'none'\n    return\n  }\n  progressBar.parentNode.style.display = 'block'\n  progressBar.value = result\n//   percentage.innerHTML = 'Ffmpeg Progress ' + result + '%'\n})\nsocketio.on('ffmpeg-error', function (error) {\n  // alert(error)\n  $('.status.on').text('Opps something went wrong.').removeClass('recording').addClass('text-danger')\n\n})\n\nsocketio.on('auth-error', function (error) {\n  // alert(error)\n  $('.status.on').text('Unauthorized!').removeClass('recording').addClass('text-danger')\n\n})\n\nsocketio.on('incoming-call', function (call) {\n  // alert(error)\n  alert('incoming call from %', call.phone_number)\n\n})\n\nfunction endRecording () {\n  if (!liveSample.isLive) {\n    //console.log('Recording stopped.')\n    return\n  }\n  // liveSample.captureCanvasImage()\n  $('.status.on.recording').text('Recording stopped').removeClass('recording')\n  startRecording.disabled = false\n  stopRecording.disabled = true\n  // cameraPreview.stop()\n  cameraPreview.poster = 'ajax-loader.gif'\n  liveSample.stop()\n\n  recordAudio.stopRecording(function () {\n    // get audio data-URL\n    recordAudio.getDataURL(function (audioDataURL) {\n      var files = {\n        audio: {\n          type: recordAudio.getBlob().type || 'audio/wav',\n          dataURL: audioDataURL,\n          image: image,\n          // email: 'epmiller8464@gmail.com',\n          waveForm: liveSample.sampleBuffer,\n          createDate: moment().format('LLL'),\n          token: liveSample.audioSignature\n        }\n      }\n      socketio.emit('message', files)\n      // if (mediaStream)\n      //   mediaStream.stop()\n      cameraPreview.src = ''\n    })\n  })\n}"]}