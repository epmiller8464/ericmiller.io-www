{"version":3,"sources":["../../../public/javascripts/PeerClient.js"],"names":["noop","PeerClient","opts","self","channel","username","socket","id","broadcastConnection","emitter","EventEmitter","connected","connection","on","s","console","log","joinOrCreateRoom","data","JSON","stringify","$","prepend","e","updateDisplay","SEM","connecterror","connecttimeout","n","reconnect","nsp","reconnecting","reconnectattempt","reconnecterror","reconnectfailed","disconnect","error","toString","prototype","send","msg","emit","connect","joinBroadcast","userJoined","html"],"mappings":"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","file":"PeerClient.js","sourcesContent":["/**\n * Created by ghostmac on 6/2/16.\n */\nvar noop = function () {}\n\nfunction PeerClient (opts) {\n  var self = this\n  self.channel = opts.channel || null\n  self.username = opts.username || null\n  self.socket = opts.socket\n  self.id = self.socket.id\n  self.broadcastConnection = null\n  self.emitter = new EventEmitter()\n  self.connected = false\n\n  var connection\n  self.socket.on('connect', function (s) {\n    console.log('client connected')\n\n    if (!self.connected) {\n      console.log('conneted to server')\n      self.joinOrCreateRoom()\n    }\n  })\n\n  self.socket.on('join-broadcast', function (data) {\n    console.log('join-broadcast %s', data)\n  })\n  self.socket.on('message', function (data) {\n    console.log('>> %s', JSON.stringify(data))\n    $('#messages').prepend('<li><p>' + data.username + '>> ' + data.data + '</p></li>')\n  })\n\n  self.socket.on('connect-error', function (e) {\n\n    console.log('connect-error: %s', e)\n    self.updateDisplay(SEM.connecterror)\n  })\n\n  self.socket.on('connect-timeout', function (e) {\n    self.updateDisplay(SEM.connecttimeout)\n\n    console.log('connection timeout %s', self.socket.id)\n  })\n\n  self.socket.on('reconnect', function (n) {\n    self.reconnect()\n    console.log('client %s reconnected to room %s - attempt(%s)', self.socket.id, self.socket.nsp, n)\n  })\n\n  self.socket.on('reconnecting', function (n) {\n    self.updateDisplay(SEM.reconnecting)\n\n    console.log('reconnecting : %s', n)\n  })\n\n  self.socket.on('reconnect-attempt', function (e) {\n    self.updateDisplay(SEM.reconnectattempt)\n\n    console.log('client %s attempting to reconnect to room %s', self.socket.id, self.socket.nsp)\n  })\n\n  self.socket.on('reconnect-error', function (e) {\n    self.updateDisplay(SEM.reconnecterror)\n\n    console.log('reconnect-error -> client %s failed to reconnect to room %s', self.socket.id, self.socket.nsp)\n  })\n\n  self.socket.on('reconnect-failed', function (e) {\n    self.updateDisplay(SEM.reconnectfailed)\n\n    console.log('reconnect-failed -> client %s attempting to reconnect to room %s ---> failed', self.socket.id, self.socket.nsp)\n  })\n\n  self.socket.on('disconnect', function (e) {\n    self.disconnect()\n  })\n\n  self.socket.on('error', function (e) {\n    console.log('socket error: %s', e)\n    self.updateDisplay(SEM.error)\n    self.connected = false\n    if (e.toString() === 'Invalid namespace') {\n      console.error('socket error: %s', e)\n    }\n  })\n  return self\n}\n\nPeerClient.prototype.send = function (msg) {\n  var self = this\n  console.log('msg', msg)\n  self.socket.emit('message', {username: self.username, data: msg})\n}\n\nPeerClient.prototype.joinOrCreateRoom = function () {\n  var self = this\n\n  self.socket.emit('join-broadcast', {channel: self.channel, id: self.id, username: self.username})\n  self.updateDisplay(SEM.connect)\n\n}\nPeerClient.prototype.joinBroadcast = function () {\n  var self = this\n}\n\nPeerClient.prototype.reconnect = function () {\n  var self = this\n  self.updateDisplay(SEM.reconnect)\n\n}\n\nPeerClient.prototype.disconnect = function () {\n  var self = this\n  \n}\n\nfunction userJoined (data) {\n  var html = '<li class=\"list-group-item\" style=\"font-size: 0.75em;\">' +\n    '    <h6 class=\"pull-left\">' + data.username + '</h6>' +\n    '    <span style=\"padding-top: 10px; padding-left: 10px;\"' +\n    '          class=\"glyphicon glyphicon-heart text-success\"></span>' +\n    '</li>'\n  $('#peers').prepend(html)\n}"]}