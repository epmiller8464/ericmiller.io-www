{"version":3,"sources":["../../../public/javascripts/shared.js"],"names":["context","window","AudioContext","webkitAudioContext","createGain","createGainNode","createDelay","createDelayNode","createScriptProcessor","createJavaScriptNode","requestAnimFrame","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","setTimeout","playSound","buffer","time","source","createBufferSource","connect","destination","start","loadSounds","obj","soundMap","names","paths","name","path","push","bufferLoader","BufferLoader","bufferList","i","length","load","urlList","onload","Array","loadCount","prototype","loadBuffer","url","index","request","XMLHttpRequest","open","responseType","loader","decodeAudioData","response","alert","error","console","onerror","send"],"mappings":"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","file":"shared.js","sourcesContent":["// Start off by initializing a new context.\ncontext = new (window.AudioContext || window.webkitAudioContext)()\n\nif (!context.createGain)\n  context.createGain = context.createGainNode\nif (!context.createDelay)\n  context.createDelay = context.createDelayNode\nif (!context.createScriptProcessor)\n  context.createScriptProcessor = context.createJavaScriptNode\n\n// shim layer with setTimeout fallback\nwindow.requestAnimFrame = (function () {\n  return window.requestAnimationFrame ||\n    window.webkitRequestAnimationFrame ||\n    window.mozRequestAnimationFrame ||\n    window.oRequestAnimationFrame ||\n    window.msRequestAnimationFrame ||\n    function (callback) {\n      window.setTimeout(callback, 1000 / 60)\n    }\n})()\n\nfunction playSound (buffer, time) {\n  var source = context.createBufferSource()\n  source.buffer = buffer\n  source.connect(context.destination)\n  source[source.start ? 'start' : 'noteOn'](time)\n}\n\nfunction loadSounds (obj, soundMap, callback) {\n  // Array-ify\n  var names = []\n  var paths = []\n  for (var name in soundMap) {\n    var path = soundMap[name]\n    names.push(name)\n    paths.push(path)\n  }\n  bufferLoader = new BufferLoader(context, paths, function (bufferList) {\n    for (var i = 0; i < bufferList.length; i++) {\n      var buffer = bufferList[i]\n      var name = names[i]\n      obj[name] = buffer\n    }\n    if (callback) {\n      callback()\n    }\n  })\n  bufferLoader.load()\n}\n\nfunction BufferLoader (context, urlList, callback) {\n  this.context = context\n  this.urlList = urlList\n  this.onload = callback\n  this.bufferList = new Array()\n  this.loadCount = 0\n}\n\nBufferLoader.prototype.loadBuffer = function (url, index) {\n  // Load buffer asynchronously\n  var request = new XMLHttpRequest()\n  request.open('GET', url, true)\n  request.responseType = 'arraybuffer'\n\n  var loader = this\n\n  request.onload = function () {\n    // Asynchronously decode the audio file data in request.response\n    loader.context.decodeAudioData(\n      request.response,\n      function (buffer) {\n        if (!buffer) {\n          alert('error decoding file data: ' + url)\n          return\n        }\n        loader.bufferList[index] = buffer\n        if (++loader.loadCount == loader.urlList.length)\n          loader.onload(loader.bufferList)\n      },\n      function (error) {\n        console.error('decodeAudioData error', error)\n      }\n    )\n  }\n\n  request.onerror = function () {\n    alert('BufferLoader: XHR error')\n  }\n\n  request.send()\n}\n\nBufferLoader.prototype.load = function () {\n  for (var i = 0; i < this.urlList.length; ++i)\n    this.loadBuffer(this.urlList[i], i);\n}\n\n\n\n"]}